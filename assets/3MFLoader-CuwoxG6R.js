import{L as Oe,F as Qe,T as Ye,G as Ce,C as Ze,S as _e,M as et,B as xe,a as Be,c as Ae,d as we,b as ue,R as Fe,e as Ue,f as Ge,g as Se,h as ze,N as He,i as tt}from"./index-DOSIwoZ8.js";/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var q=Uint8Array,te=Uint16Array,rt=Int32Array,$e=new q([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),We=new q([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),nt=new q([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Xe=function(r,s){for(var f=new te(31),m=0;m<31;++m)f[m]=s+=1<<r[m-1];for(var h=new rt(f[30]),m=1;m<30;++m)for(var x=f[m];x<f[m+1];++x)h[x]=x-f[m]<<5|m;return{b:f,r:h}},Ke=Xe($e,2),Ve=Ke.b,ot=Ke.r;Ve[28]=258,ot[258]=28;var st=Xe(We,0),it=st.b,je=new te(32768);for(var F=0;F<32768;++F){var Y=(F&43690)>>1|(F&21845)<<1;Y=(Y&52428)>>2|(Y&13107)<<2,Y=(Y&61680)>>4|(Y&3855)<<4,je[F]=((Y&65280)>>8|(Y&255)<<8)>>1}var pe=(function(r,s,f){for(var m=r.length,h=0,x=new te(s);h<m;++h)r[h]&&++x[r[h]-1];var S=new te(s);for(h=1;h<s;++h)S[h]=S[h-1]+x[h-1]<<1;var M;if(f){M=new te(1<<s);var k=15-s;for(h=0;h<m;++h)if(r[h])for(var C=h<<4|r[h],D=s-r[h],v=S[r[h]-1]++<<D,A=v|(1<<D)-1;v<=A;++v)M[je[v]>>k]=C}else for(M=new te(m),h=0;h<m;++h)r[h]&&(M[h]=je[S[r[h]-1]++]>>15-r[h]);return M}),fe=new q(288);for(var F=0;F<144;++F)fe[F]=8;for(var F=144;F<256;++F)fe[F]=9;for(var F=256;F<280;++F)fe[F]=7;for(var F=280;F<288;++F)fe[F]=8;var Je=new q(32);for(var F=0;F<32;++F)Je[F]=5;var at=pe(fe,9,1),lt=pe(Je,5,1),De=function(r){for(var s=r[0],f=1;f<r.length;++f)r[f]>s&&(s=r[f]);return s},G=function(r,s,f){var m=s/8|0;return(r[m]|r[m+1]<<8)>>(s&7)&f},Ee=function(r,s){var f=s/8|0;return(r[f]|r[f+1]<<8|r[f+2]<<16)>>(s&7)},ct=function(r){return(r+7)/8|0},qe=function(r,s,f){return(s==null||s<0)&&(s=0),(f==null||f>r.length)&&(f=r.length),new q(r.subarray(s,f))},ut=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],U=function(r,s,f){var m=new Error(s||ut[r]);if(m.code=r,Error.captureStackTrace&&Error.captureStackTrace(m,U),!f)throw m;return m},pt=function(r,s,f,m){var h=r.length,x=m?m.length:0;if(!h||s.f&&!s.l)return f||new q(0);var S=!f,M=S||s.i!=2,k=s.i;S&&(f=new q(h*3));var C=function(n){var l=f.length;if(n>l){var u=new q(Math.max(l*2,n));u.set(f),f=u}},D=s.f||0,v=s.p||0,A=s.b||0,L=s.l,K=s.d,W=s.m,O=s.n,re=h*8;do{if(!L){D=G(r,v,1);var ee=G(r,v+1,3);if(v+=3,ee)if(ee==1)L=at,K=lt,W=9,O=5;else if(ee==2){var se=G(r,v,31)+257,de=G(r,v+10,15)+4,me=se+G(r,v+5,31)+1;v+=14;for(var Z=new q(me),ie=new q(19),I=0;I<de;++I)ie[nt[I]]=G(r,v+I*3,7);v+=de*3;for(var he=De(ie),Me=(1<<he)-1,Te=pe(ie,he,1),I=0;I<me;){var ge=Te[G(r,v,Me)];v+=ge&15;var B=ge>>4;if(B<16)Z[I++]=B;else{var V=0,X=0;for(B==16?(X=3+G(r,v,3),v+=2,V=Z[I-1]):B==17?(X=3+G(r,v,7),v+=3):B==18&&(X=11+G(r,v,127),v+=7);X--;)Z[I++]=V}}var ve=Z.subarray(0,se),H=Z.subarray(se);W=De(ve),O=De(H),L=pe(ve,W,1),K=pe(H,O,1)}else U(1);else{var B=ct(v)+4,ne=r[B-4]|r[B-3]<<8,oe=B+ne;if(oe>h){k&&U(0);break}M&&C(A+ne),f.set(r.subarray(B,oe),A),s.b=A+=ne,s.p=v=oe*8,s.f=D;continue}if(v>re){k&&U(0);break}}M&&C(A+131072);for(var be=(1<<W)-1,Ne=(1<<O)-1,ae=v;;ae=v){var V=L[Ee(r,v)&be],J=V>>4;if(v+=V&15,v>re){k&&U(0);break}if(V||U(2),J<256)f[A++]=J;else if(J==256){ae=v,L=null;break}else{var le=J-254;if(J>264){var I=J-257,_=$e[I];le=G(r,v,(1<<_)-1)+Ve[I],v+=_}var t=K[Ee(r,v)&Ne],e=t>>4;t||U(3),v+=t&15;var H=it[e];if(e>3){var _=We[e];H+=Ee(r,v)&(1<<_)-1,v+=_}if(v>re){k&&U(0);break}M&&C(A+131072);var o=A+le;if(A<H){var i=x-H,a=Math.min(H,o);for(i+A<0&&U(3);A<a;++A)f[A]=m[i+A]}for(;A<o;++A)f[A]=f[A-H]}}s.l=L,s.p=ae,s.b=A,s.f=D,L&&(D=1,s.m=W,s.d=K,s.n=O)}while(!D);return A!=f.length&&S?qe(f,0,A):f.subarray(0,A)},ft=new q(0),$=function(r,s){return r[s]|r[s+1]<<8},z=function(r,s){return(r[s]|r[s+1]<<8|r[s+2]<<16|r[s+3]<<24)>>>0},Re=function(r,s){return z(r,s)+z(r,s+4)*4294967296};function dt(r,s){return pt(r,{i:2},s&&s.out,s&&s.dictionary)}var Pe=typeof TextDecoder<"u"&&new TextDecoder,mt=0;try{Pe.decode(ft,{stream:!0}),mt=1}catch{}var ht=function(r){for(var s="",f=0;;){var m=r[f++],h=(m>127)+(m>223)+(m>239);if(f+h>r.length)return{s,r:qe(r,f-1)};h?h==3?(m=((m&15)<<18|(r[f++]&63)<<12|(r[f++]&63)<<6|r[f++]&63)-65536,s+=String.fromCharCode(55296|m>>10,56320|m&1023)):h&1?s+=String.fromCharCode((m&31)<<6|r[f++]&63):s+=String.fromCharCode((m&15)<<12|(r[f++]&63)<<6|r[f++]&63):s+=String.fromCharCode(m)}};function gt(r,s){if(s){for(var f="",m=0;m<r.length;m+=16384)f+=String.fromCharCode.apply(null,r.subarray(m,m+16384));return f}else{if(Pe)return Pe.decode(r);var h=ht(r),x=h.s,f=h.r;return f.length&&U(8),x}}var vt=function(r,s){return s+30+$(r,s+26)+$(r,s+28)},bt=function(r,s,f){var m=$(r,s+28),h=gt(r.subarray(s+46,s+46+m),!($(r,s+8)&2048)),x=s+46+m,S=z(r,s+20),M=f&&S==4294967295?yt(r,x):[S,z(r,s+24),z(r,s+42)],k=M[0],C=M[1],D=M[2];return[$(r,s+10),k,C,h,x+$(r,s+30)+$(r,s+32),D]},yt=function(r,s){for(;$(r,s)!=1;s+=4+$(r,s+2));return[Re(r,s+12),Re(r,s+4),Re(r,s+20)]};function xt(r,s){for(var f={},m=r.length-22;z(r,m)!=101010256;--m)(!m||r.length-m>65558)&&U(13);var h=$(r,m+8);if(!h)return{};var x=z(r,m+16),S=x==4294967295||h==65535;if(S){var M=z(r,m-12);S=z(r,M)==101075792,S&&(h=z(r,M+32),x=z(r,M+48))}for(var k=0;k<h;++k){var C=bt(r,x,S),D=C[0],v=C[1],A=C[2],L=C[3],K=C[4],W=C[5],O=vt(r,W);x=K,D?D==8?f[L]=dt(r.subarray(O,O+v),{out:new q(A)}):U(14,"unknown compression type "+D):f[L]=qe(r,O,O+v)}return f}const Ie=_e;class wt extends Oe{constructor(s){super(s),this.availableExtensions=[]}load(s,f,m,h){const x=this,S=new Qe(x.manager);S.setPath(x.path),S.setResponseType("arraybuffer"),S.setRequestHeader(x.requestHeader),S.setWithCredentials(x.withCredentials),S.load(s,function(M){try{f(x.parse(M))}catch(k){h?h(k):console.error(k),x.manager.itemError(s)}},m,h)}parse(s){const f=this,m=new Ye(this.manager);function h(t){let e=null,o=null,i,a;const n=[],l=[];let u;const c={},d={},g={},p=new TextDecoder;try{e=xt(new Uint8Array(t))}catch(y){if(y instanceof ReferenceError)return console.error("THREE.3MFLoader: fflate missing and file is compressed."),null}let j=null;for(o in e)o.match(/\_rels\/.rels$/)?i=o:o.match(/3D\/_rels\/.*\.model\.rels$/)?a=o:o.match(/^3D\/[^\/]*\.model$/)?j=o:o.match(/^3D\/.*\/.*\.model$/)?n.push(o):o.match(/^3D\/Textures?\/.*/)&&l.push(o);if(n.push(j),i===void 0)throw new Error("THREE.ThreeMFLoader: Cannot find relationship file `rels` in 3MF archive.");const w=e[i],T=p.decode(w),E=x(T);if(a){const y=e[a],b=p.decode(y);u=x(b)}for(let y=0;y<n.length;y++){const b=n[y],N=e[b],R=p.decode(N),ye=new DOMParser().parseFromString(R,"application/xml");ye.documentElement.nodeName.toLowerCase()!=="model"&&console.error("THREE.3MFLoader: Error loading 3MF - no 3MF document found: ",b);const Q=ye.querySelector("model"),ce={};for(let ke=0;ke<Q.attributes.length;ke++){const Le=Q.attributes[ke];Le.name.match(/^xmlns:(.+)$/)&&(ce[Le.value]=RegExp.$1)}const P=se(Q);P.xml=Q,0<Object.keys(ce).length&&(P.extensions=ce),c[b]=P}for(let y=0;y<l.length;y++){const b=l[y];g[b]=e[b].buffer}return{rels:E,modelRels:u,model:c,printTicket:d,texture:g}}function x(t){const e=[],i=new DOMParser().parseFromString(t,"application/xml").querySelectorAll("Relationship");for(let a=0;a<i.length;a++){const n=i[a],l={target:n.getAttribute("Target"),id:n.getAttribute("Id"),type:n.getAttribute("Type")};e.push(l)}return e}function S(t){const e={};for(let o=0;o<t.length;o++){const i=t[o],a=i.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(a)&&(e[a]=i.textContent)}return e}function M(t){const e={id:t.getAttribute("id"),basematerials:[]},o=t.querySelectorAll("base");for(let i=0;i<o.length;i++){const a=o[i],n=K(a);n.index=i,e.basematerials.push(n)}return e}function k(t){return{id:t.getAttribute("id"),path:t.getAttribute("path"),contenttype:t.getAttribute("contenttype"),tilestyleu:t.getAttribute("tilestyleu"),tilestylev:t.getAttribute("tilestylev"),filter:t.getAttribute("filter")}}function C(t){const e={id:t.getAttribute("id"),texid:t.getAttribute("texid"),displaypropertiesid:t.getAttribute("displaypropertiesid")},o=t.querySelectorAll("tex2coord"),i=[];for(let a=0;a<o.length;a++){const n=o[a],l=n.getAttribute("u"),u=n.getAttribute("v");i.push(parseFloat(l),parseFloat(u))}return e.uvs=new Float32Array(i),e}function D(t){const e={id:t.getAttribute("id"),displaypropertiesid:t.getAttribute("displaypropertiesid")},o=t.querySelectorAll("color"),i=[],a=new Ze;for(let n=0;n<o.length;n++){const u=o[n].getAttribute("color");a.setStyle(u.substring(0,7),Ie),i.push(a.r,a.g,a.b)}return e.colors=new Float32Array(i),e}function v(t){const e=t.children,o={};for(let i=0;i<e.length;i++){const a={type:e[i].nodeName.substring(2)};for(let n=0;n<e[i].attributes.length;n++){const l=e[i].attributes[n];l.specified&&(a[l.name]=l.value)}o[e[i].getAttribute("identifier")]=a}return o}function A(t){const e={id:t.getAttribute("id"),displayname:t.getAttribute("displayname")},o=t.children,i={};for(let a=0;a<o.length;a++){const n=o[a];if(n.nodeName==="i:in"||n.nodeName==="i:out")i[n.nodeName==="i:in"?"inputs":"outputs"]=v(n);else{const l=n.children,u={op:n.nodeName.substring(2),identifier:n.getAttribute("identifier")};for(let c=0;c<l.length;c++)u[l[c].nodeName.substring(2)]=v(l[c]);i[u.identifier]=u}}return e.operations=i,e}function L(t){const e={id:t.getAttribute("id")},o=t.querySelectorAll("pbmetallic"),i=[];for(let a=0;a<o.length;a++){const n=o[a];i.push({name:n.getAttribute("name"),metallicness:parseFloat(n.getAttribute("metallicness")),roughness:parseFloat(n.getAttribute("roughness"))})}return e.data=i,e}function K(t){const e={};return e.name=t.getAttribute("name"),e.displaycolor=t.getAttribute("displaycolor"),e.displaypropertiesid=t.getAttribute("displaypropertiesid"),e}function W(t){const e={},o=[],i=t.querySelectorAll("vertices vertex");for(let u=0;u<i.length;u++){const c=i[u],d=c.getAttribute("x"),g=c.getAttribute("y"),p=c.getAttribute("z");o.push(parseFloat(d),parseFloat(g),parseFloat(p))}e.vertices=new Float32Array(o);const a=[],n=[],l=t.querySelectorAll("triangles triangle");for(let u=0;u<l.length;u++){const c=l[u],d=c.getAttribute("v1"),g=c.getAttribute("v2"),p=c.getAttribute("v3"),j=c.getAttribute("p1"),w=c.getAttribute("p2"),T=c.getAttribute("p3"),E=c.getAttribute("pid"),y={};y.v1=parseInt(d,10),y.v2=parseInt(g,10),y.v3=parseInt(p,10),n.push(y.v1,y.v2,y.v3),j&&(y.p1=parseInt(j,10)),w&&(y.p2=parseInt(w,10)),T&&(y.p3=parseInt(T,10)),E&&(y.pid=E),0<Object.keys(y).length&&a.push(y)}return e.triangleProperties=a,e.triangles=new Uint32Array(n),e}function O(t){const e=[],o=t.querySelectorAll("component");for(let i=0;i<o.length;i++){const a=o[i],n=re(a);e.push(n)}return e}function re(t){const e={};e.objectId=t.getAttribute("objectid");const o=t.getAttribute("transform");return o&&(e.transform=ee(o)),e}function ee(t){const e=[];t.split(" ").forEach(function(i){e.push(parseFloat(i))});const o=new et;return o.set(e[0],e[3],e[6],e[9],e[1],e[4],e[7],e[10],e[2],e[5],e[8],e[11],0,0,0,1),o}function B(t){const e={type:t.getAttribute("type")},o=t.getAttribute("id");o&&(e.id=o);const i=t.getAttribute("pid");i&&(e.pid=i);const a=t.getAttribute("pindex");a&&(e.pindex=a);const n=t.getAttribute("thumbnail");n&&(e.thumbnail=n);const l=t.getAttribute("partnumber");l&&(e.partnumber=l);const u=t.getAttribute("name");u&&(e.name=u);const c=t.querySelector("mesh");c&&(e.mesh=W(c));const d=t.querySelector("components");return d&&(e.components=O(d)),e}function ne(t){const e={};e.basematerials={};const o=t.querySelectorAll("basematerials");for(let d=0;d<o.length;d++){const g=o[d],p=M(g);e.basematerials[p.id]=p}e.texture2d={};const i=t.querySelectorAll("texture2d");for(let d=0;d<i.length;d++){const g=i[d],p=k(g);e.texture2d[p.id]=p}e.colorgroup={};const a=t.querySelectorAll("colorgroup");for(let d=0;d<a.length;d++){const g=a[d],p=D(g);e.colorgroup[p.id]=p}const n=t.querySelectorAll("implicitfunction");n.length>0&&(e.implicitfunction={});for(let d=0;d<n.length;d++){const g=n[d],p=A(g);e.implicitfunction[p.id]=p}e.pbmetallicdisplayproperties={};const l=t.querySelectorAll("pbmetallicdisplayproperties");for(let d=0;d<l.length;d++){const g=l[d],p=L(g);e.pbmetallicdisplayproperties[p.id]=p}e.texture2dgroup={};const u=t.querySelectorAll("texture2dgroup");for(let d=0;d<u.length;d++){const g=u[d],p=C(g);e.texture2dgroup[p.id]=p}e.object={};const c=t.querySelectorAll("object");for(let d=0;d<c.length;d++){const g=c[d],p=B(g);e.object[p.id]=p}return e}function oe(t){const e=[],o=t.querySelectorAll("item");for(let i=0;i<o.length;i++){const a=o[i],n={objectId:a.getAttribute("objectid")},l=a.getAttribute("transform");l&&(n.transform=ee(l)),e.push(n)}return e}function se(t){const e={unit:t.getAttribute("unit")||"millimeter"},o=t.querySelectorAll("metadata");o&&(e.metadata=S(o));const i=t.querySelector("resources");i&&(e.resources=ne(i));const a=t.querySelector("build");return a&&(e.build=oe(a)),e}function de(t,e,o,i){const a=t.texid,l=o.resources.texture2d[a];if(l){const u=i[l.path],c=l.contenttype,d=new Blob([u],{type:c}),g=URL.createObjectURL(d),p=m.load(g,function(){URL.revokeObjectURL(g)});switch(p.colorSpace=Ie,l.tilestyleu){case"wrap":p.wrapS=Fe;break;case"mirror":p.wrapS=Ge;break;case"none":case"clamp":p.wrapS=Ue;break;default:p.wrapS=Fe}switch(l.tilestylev){case"wrap":p.wrapT=Fe;break;case"mirror":p.wrapT=Ge;break;case"none":case"clamp":p.wrapT=Ue;break;default:p.wrapT=Fe}switch(l.filter){case"auto":p.magFilter=Se,p.minFilter=ze;break;case"linear":p.magFilter=Se,p.minFilter=Se,p.generateMipmaps=!1;break;case"nearest":p.magFilter=He,p.minFilter=He,p.generateMipmaps=!1;break;default:p.magFilter=Se,p.minFilter=ze}return p}else return null}function me(t,e,o,i,a,n,l){const u=l.pindex,c={};for(let p=0,j=e.length;p<j;p++){const w=e[p],T=w.p1!==void 0?w.p1:u;c[T]===void 0&&(c[T]=[]),c[T].push(w)}const d=Object.keys(c),g=[];for(let p=0,j=d.length;p<j;p++){const w=d[p],T=c[w],E=t.basematerials[w],y=X(E,i,a,n,l,ve),b=new xe,N=[],R=o.vertices;for(let Q=0,ce=T.length;Q<ce;Q++){const P=T[Q];N.push(R[P.v1*3+0]),N.push(R[P.v1*3+1]),N.push(R[P.v1*3+2]),N.push(R[P.v2*3+0]),N.push(R[P.v2*3+1]),N.push(R[P.v2*3+2]),N.push(R[P.v3*3+0]),N.push(R[P.v3*3+1]),N.push(R[P.v3*3+2])}b.setAttribute("position",new ue(N,3));const ye=new we(b,y);g.push(ye)}return g}function Z(t,e,o,i,a,n,l){const u=new xe,c=[],d=[],g=o.vertices,p=t.uvs;for(let E=0,y=e.length;E<y;E++){const b=e[E];c.push(g[b.v1*3+0]),c.push(g[b.v1*3+1]),c.push(g[b.v1*3+2]),c.push(g[b.v2*3+0]),c.push(g[b.v2*3+1]),c.push(g[b.v2*3+2]),c.push(g[b.v3*3+0]),c.push(g[b.v3*3+1]),c.push(g[b.v3*3+2]),d.push(p[b.p1*2+0]),d.push(p[b.p1*2+1]),d.push(p[b.p2*2+0]),d.push(p[b.p2*2+1]),d.push(p[b.p3*2+0]),d.push(p[b.p3*2+1])}u.setAttribute("position",new ue(c,3)),u.setAttribute("uv",new ue(d,2));const j=X(t,i,a,n,l,de),w=new Ae({map:j,flatShading:!0});return new we(u,w)}function ie(t,e,o,i){const a=new xe,n=[],l=[],u=o.vertices,c=t.colors;for(let p=0,j=e.length;p<j;p++){const w=e[p],T=w.v1,E=w.v2,y=w.v3;n.push(u[T*3+0]),n.push(u[T*3+1]),n.push(u[T*3+2]),n.push(u[E*3+0]),n.push(u[E*3+1]),n.push(u[E*3+2]),n.push(u[y*3+0]),n.push(u[y*3+1]),n.push(u[y*3+2]);const b=w.p1!==void 0?w.p1:i.pindex,N=w.p2!==void 0?w.p2:b,R=w.p3!==void 0?w.p3:b;l.push(c[b*3+0]),l.push(c[b*3+1]),l.push(c[b*3+2]),l.push(c[N*3+0]),l.push(c[N*3+1]),l.push(c[N*3+2]),l.push(c[R*3+0]),l.push(c[R*3+1]),l.push(c[R*3+2])}a.setAttribute("position",new ue(n,3)),a.setAttribute("color",new ue(l,3));const d=new Ae({vertexColors:!0,flatShading:!0});return new we(a,d)}function I(t){const e=new xe;e.setIndex(new Be(t.triangles,1)),e.setAttribute("position",new Be(t.vertices,3));const o=new Ae({name:Oe.DEFAULT_MATERIAL_NAME,color:16777215,flatShading:!0});return new we(e,o)}function he(t,e,o,i,a,n){const l=Object.keys(t),u=[];for(let c=0,d=l.length;c<d;c++){const g=l[c],p=t[g];switch(Me(g,i)){case"material":const w=i.resources.basematerials[g],T=me(w,p,e,o,i,a,n);for(let b=0,N=T.length;b<N;b++)u.push(T[b]);break;case"texture":const E=i.resources.texture2dgroup[g];u.push(Z(E,p,e,o,i,a,n));break;case"vertexColors":const y=i.resources.colorgroup[g];u.push(ie(y,p,e,n));break;case"default":u.push(I(e));break;default:console.error("THREE.3MFLoader: Unsupported resource type.")}}if(n.name)for(let c=0;c<u.length;c++)u[c].name=n.name;return u}function Me(t,e){return e.resources.texture2dgroup[t]!==void 0?"texture":e.resources.basematerials[t]!==void 0?"material":e.resources.colorgroup[t]!==void 0?"vertexColors":t==="default"?"default":void 0}function Te(t,e){const o={},i=t.triangleProperties,a=e.pid;for(let n=0,l=i.length;n<l;n++){const u=i[n];let c=u.pid!==void 0?u.pid:a;c===void 0&&(c="default"),o[c]===void 0&&(o[c]=[]),o[c].push(u)}return o}function ge(t,e,o,i,a){const n=new Ce,l=Te(t,a),u=he(l,t,e,o,i,a);for(let c=0,d=u.length;c<d;c++)n.add(u[c]);return n}function V(t,e,o){if(!t)return;const i=[],a=Object.keys(t);for(let n=0;n<a.length;n++){const l=a[n];for(let u=0;u<f.availableExtensions.length;u++){const c=f.availableExtensions[u];c.ns===l&&i.push(c)}}for(let n=0;n<i.length;n++){const l=i[n];l.apply(o,t[l.ns],e)}}function X(t,e,o,i,a,n){return t.build!==void 0||(t.build=n(t,e,o,i,a)),t.build}function ve(t,e,o){let i;const a=t.displaypropertiesid,n=o.resources.pbmetallicdisplayproperties;if(a!==null&&n[a]!==void 0){const d=n[a].data[t.index];i=new tt({flatShading:!0,roughness:d.roughness,metalness:d.metallicness})}else i=new Ae({flatShading:!0});i.name=t.name;const l=t.displaycolor,u=l.substring(0,7);return i.color.setStyle(u,Ie),l.length===9&&(i.opacity=parseInt(l.charAt(7)+l.charAt(8),16)/255),i}function H(t,e,o,i){const a=new Ce;for(let n=0;n<t.length;n++){const l=t[n];let u=e[l.objectId];u===void 0&&(be(l.objectId,e,o,i),u=e[l.objectId]);const c=u.clone(),d=l.transform;d&&c.applyMatrix4(d),a.add(c)}return a}function be(t,e,o,i){const a=o.resources.object[t];if(a.mesh){const n=a.mesh,l=o.extensions,u=o.xml;V(l,n,u),e[a.id]=X(n,e,o,i,a,ge)}else{const n=a.components;e[a.id]=X(n,e,o,i,a,H)}a.name&&(e[a.id].name=a.name),o.resources.implicitfunction&&console.warn("THREE.ThreeMFLoader: Implicit Functions are implemented in data-only.",o.resources.implicitfunction)}function Ne(t){const e=t.model,o=t.modelRels,i={},a=Object.keys(e),n={};if(o)for(let l=0,u=o.length;l<u;l++){const c=o[l],d=c.target.substring(1);t.texture[d]&&(n[c.target]=t.texture[d])}for(let l=0;l<a.length;l++){const u=a[l],c=e[u],d=Object.keys(c.resources.object);for(let g=0;g<d.length;g++){const p=d[g];be(p,i,c,n)}}return i}function ae(t){for(let e=0;e<t.length;e++){const o=t[e];if(o.target.split(".").pop().toLowerCase()==="model")return o}}function J(t,e){const o=new Ce,i=ae(e.rels),a=e.model[i.target.substring(1)].build;for(let n=0;n<a.length;n++){const l=a[n],u=t[l.objectId].clone(),c=l.transform;c&&u.applyMatrix4(c),o.add(u)}return o}const le=h(s),_=Ne(le);return J(_,le)}addExtension(s){this.availableExtensions.push(s)}}export{wt as ThreeMFLoader};
